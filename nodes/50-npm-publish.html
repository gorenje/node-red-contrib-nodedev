<script type="text/javascript">
    RED.nodes.registerType('NpmPublish',{
    color: '#e5e4ef',
    icon: "font-awesome/fa-money",
    category: 'nodedev',
    defaults: {
      name: {
        value:"",
      },
      otp: {
        value: "",
      },
      action: {
        value: "publish"
      },
      access: {
        value: "public"
      },
      registry: { 
        value: "registry.npmjs.org"
      },
      authToken: {
        value: "NPM_AUTH_TOKEN",
      },
      authTokenType: {
        value: "env",
      },
    },

    inputs: 1,
    outputs: 1,

    label: function() {
      return (this.name || (this.action == "publish" ? "NpmPublish" : "NpmUnpublish" )|| this._def.paletteLabel);
    },

    labelStyle: function() {
      return this.name?"node_label_italic":"";
    },

    onpaletteadd: function() {
    },

    oneditprepare: function() {
      var sltObj = $('#node-input-action');
      sltObj.html("");
      
      ["publish","unpublish"].forEach( function(v) {
         sltObj.append($('<option></option>').val(v).html(v));
      });
      
      sltObj.val(this.action || "publish");

      $("#node-input-authToken").typedInput({
          types:["env", "msg", "flow","global", "cred"],
          typeField: "#node-input-authTokenType"
      });
    },

    oneditcancel: function() {
    },

    oneditsave: function() {
    },


  });
</script>

<script type="text/html" data-template-name="NpmPublish">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

    <div class="form-row">
        <label for="node-input-registry"><i class="fa fa-database"></i> Registry</label>
        <input type="text" id="node-input-registry" placeholder="Registry">
    </div>

    <div class="form-row">
        <label for="node-input-access"><i class="fa fa-user-secret"></i> Access</label>
        <input type="text" id="node-input-access" placeholder="Access">
    </div>

    <div class="form-row">
      <label for="node-input-authToken">
            <i class="fa fa-tag"></i>
            Auth Token
       </label>
      <input type="text" id="node-input-authToken">
      <input type="hidden" id="node-input-authTokenType">
    </div>

    <div class="form-row">
       <label for="node-input-otp"><i class="fa fa-tag"></i> OTP</label>
       <input type="text" id="node-input-otp" placeholder="One Time Password">
    </div>

    <div class="form-row">
      <label for="node-input-action">
        <i class="fa fa-tag"></i> Action
      </label>
      <select id="node-input-action"></select>
    </div>
</script>

<script type="text/html" data-help-name="NpmPublish">
    <p>Publish tarball to NpmJS registry.</p>
    This publishes or unpublishes a tarball generated by the NpmTarball node.

    The package name is taken from the package.json if not supplied.
</script>